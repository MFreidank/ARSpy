from numpy import array_equal
from numpy.random import seed
from pyars.hull import compute_hulls, HullNode as hn


def test_compute_hulls():

    seed(1)

    def HullNode(m, b, left, right, pr):
        return hn(m=m, b=b, left=left, right=right, pr=pr)

    inputs = {
((-2.0,-1.996,-0.998,0.0,0.998,1.996,2.0), (-4.0,-3.984016,-0.996004,0.0,-0.996004,-3.984016,-4.0), (float("-inf"),float("inf"))): ((HullNode(3.995999999999996,3.991999999999992,-2.0,-1.996,0.0),HullNode(2.9939999999999998,1.9920079999999998,-1.996,-0.998,0.0),HullNode(0.998,0.0,-0.998,0.0,0.0),HullNode(-0.998,0.0,0.0,0.998,0.0),HullNode(-2.9939999999999998,1.9920079999999998,0.998,1.996,0.0),HullNode(-3.995999999999996,3.9919999999999924,1.996,2.0,0.0)), (HullNode(3.995999999999996,3.991999999999992,float("-inf"),-2.0,0.0018422607166365945),HullNode(2.9939999999999998,1.9920079999999998,-2.0,-1.996,2.9742698274522277e-5),HullNode(3.995999999999996,3.9919999999999924,-1.996,-1.331554369579719,0.02475975522918407),HullNode(0.998,0.0,-1.331554369579719,-0.998,0.04211918296053056),HullNode(2.9939999999999998,1.9920079999999998,-0.998,-0.499,0.17130889715661873),HullNode(-0.998,0.0,-0.499,0.0,0.2599401612387555),HullNode(0.998,0.0,0.0,0.499,0.2599401612387555),HullNode(-2.9939999999999998,1.9920079999999998,0.499,0.998,0.17130889715661873),HullNode(-0.998,0.0,0.998,1.331554369579719,0.04211918296053056),HullNode(-3.995999999999996,3.9919999999999924,1.331554369579719,1.996,0.02475975522918407),HullNode(-2.9939999999999998,1.9920079999999998,1.996,2.0,2.9742698274522277e-5),HullNode(-3.995999999999996,3.991999999999992,2.0,float("inf"),0.0018422607166365945))),
((-2.0,-1.996,-0.998,0.0,0.23993832457401928,0.998,1.996,2.0), (-4.0,-3.984016,-0.996004,0.0,-0.05757039959938747,-0.996004,-3.984016,-4.0), (float("-inf"),float("inf"))): ((HullNode(3.995999999999996,3.991999999999992,-2.0,-1.996,0.0),HullNode(2.9939999999999998,1.9920079999999998,-1.996,-0.998,0.0),HullNode(0.998,0.0,-0.998,0.0,0.0),HullNode(-0.23993832457401948,0.0,0.0,0.23993832457401928,0.0),HullNode(-1.2379383245740192,0.2394584479248712,0.23993832457401928,0.998,0.0),HullNode(-2.9939999999999998,1.9920079999999998,0.998,1.996,0.0),HullNode(-3.995999999999996,3.9919999999999924,1.996,2.0,0.0)), (HullNode(3.995999999999996,3.991999999999992,float("-inf"),-2.0,0.002179275588871513),HullNode(2.9939999999999998,1.9920079999999998,-2.0,-1.996,3.518369344333319e-5),HullNode(3.995999999999996,3.9919999999999924,-1.996,-1.331554369579719,0.0292891932559394),HullNode(0.998,0.0,-1.331554369579719,-0.998,0.04982427645565632),HullNode(2.9939999999999998,1.9920079999999998,-0.998,-0.6159696939373113,0.12544352294830283),HullNode(-0.23993832457401948,0.0,-0.6159696939373113,0.0,0.3156191320301447),HullNode(0.998,0.0,0.0,0.10709528312704766,0.05374047932025691),HullNode(-1.2379383245740192,0.2394584479248712,0.10709528312704766,0.23993832457401928,0.06481138839142465),HullNode(-0.23993832457401948,0.0,0.23993832457401928,0.7232982535483301,0.20485335208021965),HullNode(-2.9939999999999998,1.9920079999999998,0.7232982535483301,0.998,0.0748487336960321),HullNode(-1.2379383245740192,0.23945844792487125,0.998,1.3605720225583964,0.0513009575252568),HullNode(-3.995999999999996,3.9919999999999924,1.3605720225583964,1.996,0.025840045732137017),HullNode(-2.9939999999999998,1.9920079999999998,1.996,2.0,3.518369344333319e-5),HullNode(-3.995999999999996,3.991999999999992,2.0,float("inf"),0.002179275588871513))),
((-2.0,-1.996,-0.998,-0.8800172097764271,0.0,0.23993832457401928,0.998,1.996,2.0), (-4.0,-3.984016,-0.996004,-0.774430289502688,0.0,-0.05757039959938747,-0.996004,-3.984016,-4.0), (float("-inf"),float("inf"))): ((HullNode(3.995999999999996,3.991999999999992,-2.0,-1.996,0.0),HullNode(2.9939999999999998,1.9920079999999998,-1.996,-0.998,0.0),HullNode(1.8780172097764274,0.8782571753568745,-0.998,-0.8800172097764271,0.0),HullNode(0.8800172097764271,0.0,-0.8800172097764271,0.0,0.0),HullNode(-0.23993832457401948,0.0,0.0,0.23993832457401928,0.0),HullNode(-1.2379383245740192,0.2394584479248712,0.23993832457401928,0.998,0.0),HullNode(-2.9939999999999998,1.9920079999999998,0.998,1.996,6.9102836612938e-310),HullNode(-3.995999999999996,3.9919999999999924,1.996,2.0,6.9102836612938e-310)), (HullNode(3.995999999999996,3.991999999999992,float("-inf"),-2.0,0.0023072862959003736),HullNode(2.9939999999999998,1.9920079999999998,-2.0,-1.996,3.725038454773825e-5),HullNode(3.995999999999996,3.9919999999999924,-1.996,-1.4701454794703213,0.016826001204617073),HullNode(1.8780172097764274,0.8782571753568745,-1.4701454794703213,-0.998,0.05821207547110876),HullNode(2.9939999999999998,1.9920079999999998,-0.998,-0.94230095401549,0.01126960884159287),HullNode(0.8800172097764271,0.0,-0.94230095401549,-0.8800172097764271,0.01406375072537214),HullNode(1.8780172097764274,0.8782571753568744,-0.8800172097764271,-0.414672150152683,0.17252553150255684),HullNode(-0.23993832457401948,0.0,-0.414672150152683,0.0,0.21947957417298392),HullNode(0.8800172097764271,0.0,0.0,0.11306113090722202,0.059841513007073896),HullNode(-1.2379383245740192,0.2394584479248712,0.11306113090722202,0.23993832457401928,0.06528880997948844),HullNode(-0.23993832457401948,0.0,0.23993832457401928,0.7232982535483301,0.21688644352167458),HullNode(-2.9939999999999998,1.9920079999999998,0.7232982535483301,0.998,0.07924535033762245),HullNode(-1.2379383245740192,0.23945844792487125,0.998,1.3605720225583964,0.05431437715772576),HullNode(-3.995999999999996,3.9919999999999924,1.3605720225583964,1.996,0.027357890717287277),HullNode(-2.9939999999999998,1.9920079999999998,1.996,2.0,3.725038454773825e-5),HullNode(-3.995999999999996,3.991999999999992,2.0,float("inf"),0.0023072862959003736))),
((-2.0,-1.996,-1.3545890926223714,-0.998,-0.8800172097764271,0.0,0.23993832457401928,0.998,1.996,2.0), (-4.0,-3.984016,-1.8349116098514995,-0.996004,-0.774430289502688,0.0,-0.05757039959938747,-0.996004,-3.984016,-4.0), (float("-inf"),float("inf"))): ((HullNode(3.995999999999996,3.991999999999992,-2.0,-1.996,6.9102836620282e-310),HullNode(3.3505890926223714,2.703759828874253,-1.996,-1.3545890926223714,0.0),HullNode(2.3525890926223716,1.3518799144371267,-1.3545890926223714,-0.998,0.0),HullNode(1.8780172097764274,0.8782571753568745,-0.998,-0.8800172097764271,0.0),HullNode(0.8800172097764271,0.0,-0.8800172097764271,0.0,0.0),HullNode(-0.23993832457401948,0.0,0.0,0.23993832457401928,0.0),HullNode(-1.2379383245740192,0.2394584479248712,0.23993832457401928,0.998,6.9102836620282e-310),HullNode(-2.9939999999999998,1.9920079999999998,0.998,1.996,0.0),HullNode(-3.995999999999996,3.9919999999999924,1.996,2.0,6.9102836620282e-310)), (HullNode(3.995999999999996,3.991999999999992,float("-inf"),-2.0,0.002316341039972353),HullNode(3.3505890926223714,2.703759828874253,-2.0,-1.996,3.73699658907195e-5),HullNode(3.995999999999996,3.9919999999999924,-1.996,-1.606488111835451,0.008807747248098489),HullNode(2.3525890926223716,1.3518799144371267,-1.606488111835451,-1.3545890926223714,0.01533176853961575),HullNode(3.3505890926223714,2.703759828874253,-1.3545890926223714,-1.2396696383943908,0.01130834736173419),HullNode(1.8780172097764274,0.8782571753568745,-1.2396696383943908,-0.998,0.03626065805292938),HullNode(2.3525890926223716,1.3518799144371267,-0.998,-0.9180400156931123,0.01642131513268813),HullNode(0.8800172097764271,0.0,-0.9180400156931123,-0.8800172097764271,0.008711112583691907),HullNode(1.8780172097764274,0.8782571753568744,-0.8800172097764271,-0.414672150152683,0.17320259292159856),HullNode(-0.23993832457401948,0.0,-0.414672150152683,0.0,0.22034090264214462),HullNode(0.8800172097764271,0.0,0.0,0.11306113090722202,0.06007635581185363),HullNode(-1.2379383245740192,0.2394584479248712,0.11306113090722202,0.23993832457401928,0.06554503022670213),HullNode(-0.23993832457401948,0.0,0.23993832457401928,0.7232982535483301,0.21773759547549149),HullNode(-2.9939999999999998,1.9920079999999998,0.7232982535483301,0.998,0.07955634181166556),HullNode(-1.2379383245740192,0.23945844792487125,0.998,1.3605720225583964,0.054527529199354066),HullNode(-3.995999999999996,3.9919999999999924,1.3605720225583964,1.996,0.027465254376159768),HullNode(-2.9939999999999998,1.9920079999999998,1.996,2.0,3.739657043687645e-5),HullNode(-3.995999999999996,3.991999999999992,2.0,float("inf"),0.002316341039972353))),
((-2.0,-1.996,-1.3545890926223714,-0.998,-0.8800172097764271,0.0,0.23993832457401928,0.7175934134521248,0.998,1.996,2.0), (-4.0,-3.984016,-1.8349116098514995,-0.996004,-0.774430289502688,0.0,-0.05757039959938747,-0.5149403070298721,-0.996004,-3.984016,-4.0), (float("-inf"),float("inf"))): ((HullNode(3.995999999999996,3.991999999999992,-2.0,-1.996,0.0),HullNode(3.3505890926223714,2.703759828874253,-1.996,-1.3545890926223714,0.0),HullNode(2.3525890926223716,1.3518799144371267,-1.3545890926223714,-0.998,0.0),HullNode(1.8780172097764274,0.8782571753568745,-0.998,-0.8800172097764271,0.0),HullNode(0.8800172097764271,0.0,-0.8800172097764271,0.0,0.0),HullNode(-0.23993832457401948,0.0,0.0,0.23993832457401928,0.0),HullNode(-0.9575317380261441,0.17217816134905428,0.23993832457401928,0.7175934134521248,0.0),HullNode(-1.7155934134521247,0.7161582266252204,0.7175934134521248,0.998,0.0),HullNode(-2.9939999999999998,1.9920079999999998,0.998,1.996,0.0),HullNode(-3.995999999999996,3.9919999999999924,1.996,2.0,0.0)), (HullNode(3.995999999999996,3.991999999999992,float("-inf"),-2.0,0.0023924701429946524),HullNode(3.3505890926223714,2.703759828874253,-2.0,-1.996,3.859817103587738e-5),HullNode(3.995999999999996,3.9919999999999924,-1.996,-1.606488111835451,0.009097223575665895),HullNode(2.3525890926223716,1.3518799144371267,-1.606488111835451,-1.3545890926223714,0.015835664022415808),HullNode(3.3505890926223714,2.703759828874253,-1.3545890926223714,-1.2396696383943908,0.011680008670003236),HullNode(1.8780172097764274,0.8782571753568745,-1.2396696383943908,-0.998,0.03745240457251821),HullNode(2.3525890926223716,1.3518799144371267,-0.998,-0.9180400156931123,0.016961019765954474),HullNode(0.8800172097764271,0.0,-0.9180400156931123,-0.8800172097764271,0.00899741290643309),HullNode(1.8780172097764274,0.8782571753568744,-0.8800172097764271,-0.414672150152683,0.17889508716692576),HullNode(-0.23993832457401948,0.0,-0.414672150152683,0.0,0.22758264942631873),HullNode(0.8800172097764271,0.0,0.0,0.09369990473176411,0.05098207851518789),HullNode(-0.9575317380261441,0.17217816134905428,0.09369990473176411,0.23993832457401928,0.07735178647159932),HullNode(-0.23993832457401948,0.0,0.23993832457401928,0.4853154588920188,0.11742474190719648),HullNode(-1.7155934134521247,0.7161582266252204,0.4853154588920188,0.7175934134521248,0.08900695240107832),HullNode(-0.9575317380261441,0.17217816134905428,0.7175934134521248,0.8936205256089125,0.05052510543273592),HullNode(-2.9939999999999998,1.9920079999999998,0.8936205256089125,0.998,0.023622888422928777),HullNode(-1.7155934134521247,0.7161582266252203,0.998,1.4365165373135544,0.05941654187671309),HullNode(-3.995999999999996,3.9919999999999924,1.4365165373135544,1.996,0.020306270759330305),HullNode(-2.9939999999999998,1.9920079999999998,1.996,2.0,3.862564996978652e-5),HullNode(-3.995999999999996,3.991999999999992,2.0,float("inf"),0.0023924701429946524))),
    }

    for input_vals, julia_result in inputs.items():
        julia_lower_hull, julia_upper_hull = julia_result

        our_lower_hull, our_upper_hull = compute_hulls(*input_vals)

        for node_theirs, node_ours in zip(julia_upper_hull, our_upper_hull):
            if node_theirs != node_ours:
                raise ValueError("upper", "THEIRS:", [node_theirs], "OURS:", [node_ours])

        for node_theirs, node_ours in zip(julia_lower_hull, our_lower_hull):
            if node_theirs != node_ours:
                raise ValueError("lower", "THEIRS:", [node_theirs], "OURS:", [node_ours])
